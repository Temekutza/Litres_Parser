# üìö LitRes Parser - –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

## –û–≥–ª–∞–≤–ª–µ–Ω–∏–µ
1. [–û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞](#–æ–±—â–∞—è-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
2. [–ú–æ–¥—É–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞](#–º–æ–¥—É–ª–∏-–ø—Ä–æ–µ–∫—Ç–∞)
3. [–ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞](#–ø—Ä–æ—Ü–µ—Å—Å-—Ä–∞–±–æ—Ç—ã-–ø–∞—Ä—Å–µ—Ä–∞)
4. [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–¥–∞–Ω–Ω—ã—Ö)
5. [–ö–∞–∫ –ø–∞—Ä—Å—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ](#–∫–∞–∫-–ø–∞—Ä—Å—è—Ç—Å—è-–¥–∞–Ω–Ω—ã–µ)
6. [–ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è](#–ø—Ä–∏–º–µ—Ä—ã-–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è)

---

## –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
LitRes Parser
‚îú‚îÄ‚îÄ main.py                  # –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îú‚îÄ‚îÄ requirements.txt         # –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ litres.sqlite           # –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (—Å–æ–∑–¥–∞–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏)
‚îî‚îÄ‚îÄ litres_parser/
    ‚îú‚îÄ‚îÄ __init__.py
    ‚îú‚îÄ‚îÄ cli.py              # –ö–æ–º–∞–Ω–¥–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
    ‚îú‚îÄ‚îÄ http.py             # HTTP-–∑–∞–ø—Ä–æ—Å—ã —Å rate-limiting
    ‚îú‚îÄ‚îÄ catalog.py          # Discovery —á–µ—Ä–µ–∑ –∫–∞—Ç–∞–ª–æ–≥ –∂–∞–Ω—Ä–æ–≤
    ‚îú‚îÄ‚îÄ sitemaps.py         # Discovery —á–µ—Ä–µ–∑ sitemap.xml
    ‚îú‚îÄ‚îÄ book_page.py        # –ü–∞—Ä—Å–∏–Ω–≥ —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–Ω–∏–≥–∏
    ‚îî‚îÄ‚îÄ storage.py          # –†–∞–±–æ—Ç–∞ —Å SQLite –±–∞–∑–æ–π
```

---

## –ú–æ–¥—É–ª–∏ –ø—Ä–æ–µ–∫—Ç–∞

### 1. `main.py` - –¢–æ—á–∫–∞ –≤—Ö–æ–¥–∞
- –ü—Ä–æ–≤–µ—Ä—è–µ—Ç –≤–µ—Ä—Å–∏—é Python (—Ç—Ä–µ–±—É–µ—Ç—Å—è 3.10+)
- –ó–∞–ø—É—Å–∫–∞–µ—Ç CLI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

### 2. `cli.py` - –ö–æ–º–∞–Ω–¥–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
–ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –∫–æ–º–∞–Ω–¥—ã:
- **`discover`** - –Ω–∞—Ö–æ–¥–∏—Ç URL –∫–Ω–∏–≥ –Ω–∞ —Å–∞–π—Ç–µ
- **`crawl`** - –ø–∞—Ä—Å–∏—Ç –æ—á–µ—Ä–µ–¥—å URL
- **`single`** - –ø–∞—Ä—Å–∏—Ç –æ–¥–Ω—É –∫–Ω–∏–≥—É
- **`add`** - –¥–æ–±–∞–≤–ª—è–µ—Ç URL –≤ –æ—á–µ—Ä–µ–¥—å –≤—Ä—É—á–Ω—É—é
- **`export`** - —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç –¥–∞–Ω–Ω—ã–µ –≤ Excel
- **`status`** - –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
- **`reset`** - –æ—á–∏—â–∞–µ—Ç –±–∞–∑—É –¥–ª—è –ø–æ–≤—Ç–æ—Ä–Ω–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞

### 3. `http.py` - HTTP –∫–ª–∏–µ–Ω—Ç
**–§—É–Ω–∫—Ü–∏–∏:**
- `make_session()` - —Å–æ–∑–¥–∞–µ—Ç HTTP —Å–µ—Å—Å–∏—é —Å –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏
- `polite_sleep()` - –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏ (0.5-1.5 —Å–µ–∫)
- **Rate-limiting:** –≥–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –¥–ª—è –≤–µ–∂–ª–∏–≤–æ–≥–æ –ø–∞—Ä—Å–∏–Ω–≥–∞

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- User-Agent: —Å–∏–º—É–ª–∏—Ä—É–µ—Ç –±—Ä–∞—É–∑–µ—Ä Chrome
- –¢–∞–π–º–∞—É—Ç: 30 —Å–µ–∫—É–Ω–¥
- –†–µ—Ç—Ä–∞–∏: 4 –ø–æ–ø—ã—Ç–∫–∏ –ø—Ä–∏ –æ—à–∏–±–∫–∞—Ö
- –°–ª—É—á–∞–π–Ω–∞—è –∑–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏

### 4. `catalog.py` - Discovery —á–µ—Ä–µ–∑ –∫–∞—Ç–∞–ª–æ–≥
**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ó–∞—Ö–æ–¥–∏—Ç –Ω–∞ `/pages/new_genres/`
2. –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Å–ø–∏—Å–æ–∫ –∂–∞–Ω—Ä–æ–≤
3. –î–ª—è –∫–∞–∂–¥–æ–≥–æ –∂–∞–Ω—Ä–∞ –æ–±—Ö–æ–¥–∏—Ç —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∫–∞—Ç–∞–ª–æ–≥–∞
4. –°–æ–±–∏—Ä–∞–µ—Ç URL –∫–Ω–∏–≥ –∏–∑ –∫–∞—Ä—Ç–æ—á–µ–∫

**–õ–∏–º–∏—Ç—ã:**
- `--max-pages-per-genre` - —Å–∫–æ–ª—å–∫–æ —Å—Ç—Ä–∞–Ω–∏—Ü –æ–±—Ö–æ–¥–∏—Ç—å –≤ –∫–∞–∂–¥–æ–º –∂–∞–Ω—Ä–µ
- `--limit` - –æ–±—â–∏–π –ª–∏–º–∏—Ç URL

### 5. `sitemaps.py` - Discovery —á–µ—Ä–µ–∑ Sitemap
**–ü—Ä–æ—Ü–µ—Å—Å:**
1. –ß–∏—Ç–∞–µ—Ç `robots.txt`
2. –ù–∞—Ö–æ–¥–∏—Ç —Å—Å—ã–ª–∫–∏ –Ω–∞ sitemap.xml
3. –ü–∞—Ä—Å–∏—Ç XML —Ñ–∞–π–ª—ã
4. –§–∏–ª—å—Ç—Ä—É–µ—Ç URL –∫–Ω–∏–≥ –ø–æ –ø–∞—Ç—Ç–µ—Ä–Ω—É `/book/`

### 6. `book_page.py` - –Ø–¥—Ä–æ –ø–∞—Ä—Å–µ—Ä–∞ üî•
**–≠—Ç–æ —Å–∞–º—ã–π –≤–∞–∂–Ω—ã–π –º–æ–¥—É–ª—å!** –ò–º–µ–Ω–Ω–æ –∑–¥–µ—Å—å –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–∑–≤–ª–µ—á–µ–Ω–∏–µ –≤—Å–µ—Ö –¥–∞–Ω–Ω—ã—Ö.

#### –û—Å–Ω–æ–≤–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏:

**`parse_book_page(html: str, url: str) -> dict`**
- –ì–ª–∞–≤–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞
- –ü—Ä–∏–Ω–∏–º–∞–µ—Ç HTML —Å—Ç—Ä–∞–Ω–∏—Ü—ã
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–ª–æ–≤–∞—Ä—å —Å –¥–∞–Ω–Ω—ã–º–∏

#### –°—Ç—Ä–∞—Ç–µ–≥–∏—è –ø–∞—Ä—Å–∏–Ω–≥–∞ (–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã):

1. **JSON-LD** (—Å–∞–º—ã–π –Ω–∞–¥–µ–∂–Ω—ã–π)
   - –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ `<script type="application/ld+json">`
   - –°–æ–¥–µ—Ä–∂–∏—Ç: –Ω–∞–∑–≤–∞–Ω–∏–µ, –∞–≤—Ç–æ—Ä–æ–≤, —Ä–µ–π—Ç–∏–Ω–≥, —Ü–µ–Ω—É, –∂–∞–Ω—Ä—ã

2. **__NEXT_DATA__** (–¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞)
   - Next.js –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Ö—Ä–∞–Ω–∏—Ç –¥–∞–Ω–Ω—ã–µ –≤ `<script id="__NEXT_DATA__">`
   - –°–æ–¥–µ—Ä–∂–∏—Ç: LiveLib –¥–∞–Ω–Ω—ã–µ, –≥–ª–∞–≤—ã –∫–Ω–∏–≥–∏, –æ—Ç–∑—ã–≤—ã
   - –°–∞–º—ã–π –ø–æ–ª–Ω—ã–π –∏—Å—Ç–æ—á–Ω–∏–∫ –¥–ª—è —Å–æ–≤—Ä–µ–º–µ–Ω–Ω—ã—Ö —Å—Ç—Ä–∞–Ω–∏—Ü

3. **Meta-—Ç–µ–≥–∏** (–∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç)
   - `<meta property="og:title">` - –Ω–∞–∑–≤–∞–Ω–∏–µ
   - `<meta property="og:image">` - –æ–±–ª–æ–∂–∫–∞
   - `<meta property="og:description">` - –æ–ø–∏—Å–∞–Ω–∏–µ

4. **HTML-–ø–∞—Ä—Å–∏–Ω–≥** (–ø–æ—Å–ª–µ–¥–Ω–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
   - CSS-—Å–µ–ª–µ–∫—Ç–æ—Ä—ã
   - `data-testid` –∞—Ç—Ä–∏–±—É—Ç—ã
   - Hash-–∫–ª–∞—Å—Å—ã (–¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ, –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å—Å—è)

#### –ß—Ç–æ –ø–∞—Ä—Å–∏—Ç—Å—è:

**–ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
- `url` - URL –∫–Ω–∏–≥–∏
- `title` - –Ω–∞–∑–≤–∞–Ω–∏–µ
- `authors` - –∞–≤—Ç–æ—Ä(—ã) —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é
- `price` - —Ü–µ–Ω–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä: "569 RUB")
- `description` - –∞–Ω–Ω–æ—Ç–∞—Ü–∏—è

**–†–µ–π—Ç–∏–Ω–≥–∏:**
- `rating` - —Ä–µ–π—Ç–∏–Ω–≥ LitRes
- `rating_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫ LitRes
- `livelib_rating` - —Ä–µ–π—Ç–∏–Ω–≥ LiveLib
- `livelib_rating_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ü–µ–Ω–æ–∫ LiveLib
- `reviews_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ—Ç–∑—ã–≤–æ–≤
- `quotations_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ü–∏—Ç–∞—Ç

**–ú–µ—Ç–∞-–¥–∞–Ω–Ω—ã–µ:**
- `cover_url` - URL –æ–±–ª–æ–∂–∫–∏
- `pages` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–∞–Ω–∏—Ü
- `age_restriction` - –≤–æ–∑—Ä–∞—Å—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ (18+, 16+, –∏ —Ç.–¥.)
- `genres` - –∂–∞–Ω—Ä—ã –∏ —Ç–µ–≥–∏ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)

**–°–µ—Ä–∏–∏:**
- `in_series` - –ø—Ä–∏–Ω–∞–¥–ª–µ–∂–Ω–æ—Å—Ç—å –∫ —Å–µ—Ä–∏–∏ (1/0)
- `series_title` - –Ω–∞–∑–≤–∞–Ω–∏–µ —Å–µ—Ä–∏–∏(–π)

**–§–æ—Ä–º–∞—Ç—ã:**
- `format_text` - –¥–æ—Å—Ç—É–ø–µ–Ω —Ç–µ–∫—Å—Ç–æ–≤—ã–π —Ñ–æ—Ä–º–∞—Ç (1/0)
- `format_audio` - –¥–æ—Å—Ç—É–ø–µ–Ω –∞—É–¥–∏–æ—Ñ–æ—Ä–º–∞—Ç (1/0)
- `format_paper` - –¥–æ—Å—Ç—É–ø–Ω–∞ –±—É–º–∞–∂–Ω–∞—è –≤–µ—Ä—Å–∏—è (1/0)
- `formats` - –≤—Å–µ —Ñ–æ—Ä–º–∞—Ç—ã —Ç–µ–∫—Å—Ç–æ–º (—É—Å—Ç–∞—Ä–µ–ª–æ, –Ω–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–µ—Ç—Å—è)

**–ö–æ–Ω—Ç–µ–Ω—Ç:**
- `chapters` - –Ω–∞–∑–≤–∞–Ω–∏—è –≥–ª–∞–≤ (—á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é)

#### –ü–∞—Ä—Å–∏–Ω–≥ –æ—Ç–∑—ã–≤–æ–≤:

**`_parse_reviews_from_soup(soup, url: str) -> list[dict]`**
- –ü–∞—Ä—Å–∏—Ç –æ—Ç–∑—ã–≤—ã –∏–∑ HTML

**`_parse_reviews_from_next_data(data: dict, url: str) -> list[dict]`**
- –ü–∞—Ä—Å–∏—Ç –æ—Ç–∑—ã–≤—ã –∏–∑ __NEXT_DATA__ (–±–æ–ª–µ–µ –Ω–∞–¥–µ–∂–Ω–æ)

**–î–∞–Ω–Ω—ã–µ –æ—Ç–∑—ã–≤–∞:**
- `review_id` - —É–Ω–∏–∫–∞–ª—å–Ω—ã–π ID
- `book_url` - URL –∫–Ω–∏–≥–∏
- `author` - –∞–≤—Ç–æ—Ä –æ—Ç–∑—ã–≤–∞
- `author_avatar` - URL –∞–≤–∞—Ç–∞—Ä–∫–∏
- `published_at` - –¥–∞—Ç–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏–∏ (ISO —Ñ–æ—Ä–º–∞—Ç)
- `rating` - –æ—Ü–µ–Ω–∫–∞ (1-5)
- `text` - —Ç–µ–∫—Å—Ç –æ—Ç–∑—ã–≤–∞
- `likes` - –ª–∞–π–∫–∏
- `dislikes` - –¥–∏–∑–ª–∞–π–∫–∏
- `comments_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–µ–≤
- `replies_count` - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ä–µ–ø–ª–∞–µ–≤
- `replies` - —Å–ø–∏—Å–æ–∫ —Ä–µ–ø–ª–∞–µ–≤ (–≤–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ)
- `is_livelib` - —Å LiveLib –∏–ª–∏ –Ω–µ—Ç (1/0)

**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–µ–ø–ª–∞—è:**
```python
{
    "author": "–ò–º—è",
    "author_avatar": "/pub/avatar/...",
    "published_at": "2025-06-08T08:25:02",
    "text": "–¢–µ–∫—Å—Ç —Ä–µ–ø–ª–∞—è",
    "likes": "5",
    "dislikes": "0"
}
```

### 7. `normalizer.py` - –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö üÜï
**–ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞!** –î–∞–Ω–Ω—ã–µ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è **–î–û** –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –±–∞–∑—É, –∞ –Ω–µ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ.

#### –ü—Ä–æ—Ü–µ—Å—Å:
```
–ü–∞—Ä—Å–∏–Ω–≥ ‚Üí –°—ã—Ä–æ–π JSON ‚Üí –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π JSON ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
```

#### –§—É–Ω–∫—Ü–∏–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:

**`normalize_date(iso_date: str) -> str`**
- `2023-11-20T13:48:18` ‚Üí `20.11.2023`
- ISO —Ñ–æ—Ä–º–∞—Ç ‚Üí DD.MM.YYYY

**`normalize_price(price: str) -> str`**
- `569 RUB` ‚Üí `569,00`
- `1234.50 RUB` ‚Üí `1234,50`

**`normalize_age_restriction(age: str) -> str`**
- `18+` ‚Üí `18`
- `16+` ‚Üí `16`

**`normalize_series_title(series: str) -> str`**
- `–í—Ö–æ–¥–∏—Ç –≤ —Å–µ—Ä–∏—é ¬´–ò—Ä–æ–Ω–∏—á–µ—Å–∫–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤ (–≠–∫—Å–º–æ)¬ª` ‚Üí `–ò—Ä–æ–Ω–∏—á–µ—Å–∫–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤ (–≠–∫—Å–º–æ)`
- –£–±–∏—Ä–∞–µ—Ç –ø—Ä–µ—Ñ–∏–∫—Å—ã, –∏–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ –Ω–∞–∑–≤–∞–Ω–∏—è

**`normalize_avatar_url(avatar: str) -> str`**
- `/pub/avatar/...` ‚Üí `–µ—Å—Ç—å`
- –ü—É—Å—Ç–∞—è —Å—Ç—Ä–æ–∫–∞ ‚Üí ``

**`normalize_rating(rating: str) -> str`**
- `4,9` ‚Üí `4.9`
- –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ñ–æ—Ä–º–∞—Ç (—Ç–æ—á–∫–∞ –≤–º–µ—Å—Ç–æ –∑–∞–ø—è—Ç–æ–π)

**`normalize_count(count: str) -> str`**
- `547 –æ—Ü–µ–Ω–æ–∫` ‚Üí `547`
- `1 234` ‚Üí `1234`
- –ò–∑–≤–ª–µ–∫–∞–µ—Ç —Ç–æ–ª—å–∫–æ —á–∏—Å–ª–æ

**`normalize_boolean(value: Any) -> str`**
- `True` ‚Üí `1`
- `False` ‚Üí `0`

**`normalize_book_data(raw_book: dict) -> dict`**
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∫ –¥–∞–Ω–Ω—ã–º –∫–Ω–∏–≥–∏
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≥–æ—Ç–æ–≤—ã–π —Å–ª–æ–≤–∞—Ä—å –¥–ª—è –ë–î

**`normalize_review_data(raw_review: dict) -> dict`**
- –ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—Å–µ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∫ –æ—Ç–∑—ã–≤—É
- –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç —Ä–µ–ø–ª–∞–∏ –≤–Ω—É—Ç—Ä–∏ –æ—Ç–∑—ã–≤–∞

**`normalize_reply_data(raw_reply: dict) -> dict`**
- –ù–æ—Ä–º–∞–ª–∏–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ —Ä–µ–ø–ª–∞—è

#### –û—Ç–ª–∞–¥–∫–∞:

**`save_raw_json(data: dict, filepath: str)`**
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ JSON —Ñ–∞–π–ª
- –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø–∞—Ä—Å–µ—Ä–∞

**`save_normalized_json(data: dict, filepath: str)`**
- –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ JSON —Ñ–∞–π–ª
- –ü–æ–ª–µ–∑–Ω–æ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏

### 8. `storage.py` - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
**–°—Ç—Ä—É–∫—Ç—É—Ä–∞ SQLite:**

#### –¢–∞–±–ª–∏—Ü–∞ `queue`:
```sql
url TEXT PRIMARY KEY
status TEXT (pending/in_progress/done/failed)
attempts INTEGER
last_error TEXT
discovered_at TEXT
```

#### –¢–∞–±–ª–∏—Ü–∞ `books`:
```sql
url TEXT PRIMARY KEY
title, authors, price, rating, rating_count
genres, formats, description, cover_url
pages, age_restriction
in_series, series_title
format_text, format_audio, format_paper
reviews_count, quotations_count
livelib_rating, livelib_rating_count
chapters
scraped_at TEXT
status TEXT (ok/error)
error TEXT
```

#### –¢–∞–±–ª–∏—Ü–∞ `reviews`:
```sql
review_id TEXT PRIMARY KEY
book_url TEXT
author, author_avatar
published_at, rating, text
likes, dislikes
comments_count, replies_count
replies_json TEXT (JSON –º–∞—Å—Å–∏–≤)
is_livelib INTEGER
scraped_at TEXT
```

**–§—É–Ω–∫—Ü–∏–∏:**
- `enqueue_urls()` - –¥–æ–±–∞–≤–ª—è–µ—Ç URL –≤ –æ—á–µ—Ä–µ–¥—å
- `claim_batch()` - –±–µ—Ä–µ—Ç N URL –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏
- `mark_queue_done()` - –ø–æ–º–µ—á–∞–µ—Ç URL –∫–∞–∫ –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω—ã–π
- `mark_queue_failed()` - –ø–æ–º–µ—á–∞–µ—Ç URL –∫–∞–∫ –æ—à–∏–±–æ—á–Ω—ã–π
- `upsert_book()` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–Ω–∏–≥—É
- `upsert_reviews()` - —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç/–æ–±–Ω–æ–≤–ª—è–µ—Ç –æ—Ç–∑—ã–≤—ã
- `iter_books()` - –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –∫–Ω–∏–≥–∏
- `iter_reviews()` - –ø–æ–ª—É—á–∞–µ—Ç –≤—Å–µ –æ—Ç–∑—ã–≤—ã

---

## –ü—Ä–æ—Ü–µ—Å—Å —Ä–∞–±–æ—Ç—ã –ø–∞—Ä—Å–µ—Ä–∞

### –°—Ü–µ–Ω–∞—Ä–∏–π 1: –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  1. DISCOVERY (discover)                    ‚îÇ
‚îÇ  –ò—â–µ–º URL –∫–Ω–∏–≥ –Ω–∞ —Å–∞–π—Ç–µ                     ‚îÇ
‚îÇ  ‚Üì –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ queue (status=pending)       ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  2. CRAWL (crawl) - –ù–û–í–ê–Ø –ê–†–•–ò–¢–ï–ö–¢–£–†–ê       ‚îÇ
‚îÇ  –ë–µ—Ä–µ–º URL –∏–∑ –æ—á–µ—Ä–µ–¥–∏ (5 –ø–æ—Ç–æ–∫–æ–≤)          ‚îÇ
‚îÇ  ‚Üì –°–∫–∞—á–∏–≤–∞–µ–º HTML –∫–∞–∂–¥–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã           ‚îÇ
‚îÇ  ‚Üì –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ (book_page.py)             ‚îÇ
‚îÇ  ‚Üì –°—ã—Ä–æ–π JSON (RAW)                         ‚îÇ
‚îÇ  ‚Üì –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (normalizer.py) üÜï          ‚îÇ
‚îÇ  ‚Üì –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π JSON üÜï                   ‚îÇ
‚îÇ  ‚Üì –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ books + reviews              ‚îÇ
‚îÇ  ‚Üì –ü–æ–º–µ—á–∞–µ–º queue (status=done)             ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                    ‚Üì
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  3. EXPORT (export)                         ‚îÇ
‚îÇ  –ß–∏—Ç–∞–µ–º –¥–∞–Ω–Ω—ã–µ –∏–∑ books + reviews           ‚îÇ
‚îÇ  (–¥–∞–Ω–Ω—ã–µ —É–∂–µ –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω—ã!) ‚úÖ             ‚îÇ
‚îÇ  ‚Üì –°–æ–∑–¥–∞–µ–º Excel —Å 3 –ª–∏—Å—Ç–∞–º–∏                ‚îÇ
‚îÇ     - Books (–∫–Ω–∏–≥–∏)                         ‚îÇ
‚îÇ     - Reviews (–æ—Ç–∑—ã–≤—ã)                      ‚îÇ
‚îÇ     - Replies (—Ä–µ–ø–ª–∞–∏)                      ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å CRAWL:

```python
# –ü—Å–µ–≤–¥–æ–∫–æ–¥ –ø—Ä–æ—Ü–µ—Å—Å–∞ crawl —Å 5 –ø–æ—Ç–æ–∫–∞–º–∏:

while True:
    # 1. –ë–µ—Ä–µ–º –±–∞—Ç—á URL –∏–∑ –æ—á–µ—Ä–µ–¥–∏ (–∞—Ç–æ–º–∞—Ä–Ω–æ)
    urls = claim_batch(batch_size=5)
    if not urls:
        break
    
    # 2. –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º –≤ 5 –ø–æ—Ç–æ–∫–∞—Ö
    with ThreadPoolExecutor(max_workers=5) as executor:
        for url in urls:
            executor.submit(process_url, url)

def process_url(url):
    try:
        # 3. Polite delay (–≥–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞)
        polite_sleep(0.5-1.5 sec)
        
        # 4. –°–∫–∞—á–∏–≤–∞–µ–º HTML
        response = session.get(url, timeout=30)
        html = response.text
        
        # 5. –ü–∞—Ä—Å–∏–º –¥–∞–Ω–Ω—ã–µ (–°–´–†–û–ô JSON)
        result = parse_book_page(html, url)
        raw_book = result.data
        raw_reviews = result.reviews
        
        # 6. –ù–û–†–ú–ê–õ–ò–ó–ê–¶–ò–Ø (–Ω–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞!) üÜï
        normalized_book = normalize_book_data(raw_book)
        normalized_reviews = [normalize_review_data(r) for r in raw_reviews]
        
        # 7. –°–æ—Ö—Ä–∞–Ω—è–µ–º –ù–û–†–ú–ê–õ–ò–ó–û–í–ê–ù–ù–´–ï –¥–∞–Ω–Ω—ã–µ –≤ –±–∞–∑—É
        upsert_book(normalized_book)
        upsert_reviews(normalized_reviews)
        
        # 8. –ü–æ–º–µ—á–∞–µ–º —É—Å–ø–µ—Ö
        mark_queue_done(url)
        
    except Exception as e:
        # 9. –ü–æ–º–µ—á–∞–µ–º –æ—à–∏–±–∫—É
        mark_queue_failed(url, str(e))
```

### –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ—Å—Ç—å:

- **ThreadPoolExecutor:** 5 –ø–æ—Ç–æ–∫–æ–≤ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
- **–ì–ª–æ–±–∞–ª—å–Ω—ã–π rate-limiter:** –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∑–∞–¥–µ—Ä–∂–∫—É –º–µ–∂–¥—É –∑–∞–ø—Ä–æ—Å–∞–º–∏
- **–ê—Ç–æ–º–∞—Ä–Ω–æ—Å—Ç—å:** `claim_batch()` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç SQL —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
- **–û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:** –æ—à–∏–±–∫–∏ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å

---

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

### –ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–∞—Ä—Å–∏–Ω–≥–∞ –∫–Ω–∏–≥–∏:

```python
{
    "url": "https://www.litres.ru/book/enn-tayler/francuzskaya-kosichka-69950011/",
    "title": "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∞—è –∫–æ—Å–∏—á–∫–∞",
    "authors": "–≠–Ω–Ω –¢–∞–π–ª–µ—Ä",
    "price": "569 RUB",
    "rating": "4.9",
    "rating_count": "547",
    "livelib_rating": "3.7",
    "livelib_rating_count": "951",
    "reviews_count": "25",
    "quotations_count": "12",
    "cover_url": "https://cv7.litres.ru/pub/c/cover_415/69950011.jpg",
    "pages": "352",
    "age_restriction": "18+",
    "in_series": "1",
    "series_title": "–í—Ö–æ–¥–∏—Ç –≤ —Å–µ—Ä–∏—é ¬´–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ø—Ä–æ–∑–∞ (–≠–∫—Å–º–æ)¬ª",
    "genres": "–°–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è —Ä—É—Å—Å–∫–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞, –ó–∞—Ä—É–±–µ–∂–Ω–∞—è –∫–ª–∞—Å—Å–∏–∫–∞, –°–µ–º–µ–π–Ω–∞—è —Å–∞–≥–∞",
    "format_text": "1",
    "format_audio": "0",
    "format_paper": "1",
    "formats": "—Ç–µ–∫—Å—Ç, –±—É–º–∞–≥–∞",
    "chapters": "–ì–ª–∞–≤–∞ 1, –ì–ª–∞–≤–∞ 2, –ì–ª–∞–≤–∞ 3, ...",
    "description": "–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è –∫–Ω–∏–≥–∏...",
    "scraped_at": "2026-01-17T10:30:45+00:00",
    "status": "ok",
    "error": ""
}
```

### –ü—Ä–∏–º–µ—Ä –æ—Ç–∑—ã–≤–∞ —Å —Ä–µ–ø–ª–∞—è–º–∏:

```python
{
    "review_id": "a1b2c3d4e5f6g7h8",
    "book_url": "https://www.litres.ru/book/.../",
    "author": "–ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω",
    "author_avatar": "/pub/avatar/100/00/04/52/31/40/40/452314040.jpg",
    "published_at": "2023-11-20T13:48:18",
    "rating": "5",
    "text": "–û—Ç–ª–∏—á–Ω–∞—è –∫–Ω–∏–≥–∞!",
    "likes": "15",
    "dislikes": "2",
    "comments_count": "3",
    "replies_count": "2",
    "replies": [
        {
            "author": "–ü–µ—Ç—Ä–æ–≤ –ü–µ—Ç—Ä",
            "author_avatar": "/pub/avatar/.../",
            "published_at": "2023-11-21T10:15:30",
            "text": "–°–æ–≥–ª–∞—Å–µ–Ω!",
            "likes": "5",
            "dislikes": "0"
        },
        {
            "author": "–°–∏–¥–æ—Ä–æ–≤–∞ –ú–∞—Ä–∏—è",
            "author_avatar": "/pub/avatar/.../",
            "published_at": "2023-11-22T14:20:15",
            "text": "–¢–æ–∂–µ –ø–æ–Ω—Ä–∞–≤–∏–ª–∞—Å—å",
            "likes": "3",
            "dislikes": "0"
        }
    ],
    "is_livelib": 0,
    "scraped_at": "2026-01-17T10:30:45+00:00"
}
```

---

## –ö–∞–∫ –ø–∞—Ä—Å—è—Ç—Å—è –¥–∞–Ω–Ω—ã–µ

### –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã –∏—Å—Ç–æ—á–Ω–∏–∫–æ–≤ –¥–∞–Ω–Ω—ã—Ö:

#### 1. JSON-LD (–≤—ã—Å—à–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç)
```html
<script type="application/ld+json">
{
  "@type": "Book",
  "name": "–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∞—è –∫–æ—Å–∏—á–∫–∞",
  "author": [{"@type": "Person", "name": "–≠–Ω–Ω –¢–∞–π–ª–µ—Ä"}],
  "aggregateRating": {
    "ratingValue": "4.9",
    "ratingCount": "547"
  }
}
</script>
```

#### 2. __NEXT_DATA__ (–¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞)
```html
<script id="__NEXT_DATA__" type="application/json">
{
  "props": {
    "pageProps": {
      "art": {
        "livelib": {
          "rating": 3.7,
          "marks_count": 951,
          "reviews_count": 25
        }
      },
      "getArtTOC": [
        {"title": "–ì–ª–∞–≤–∞ 1"},
        {"title": "–ì–ª–∞–≤–∞ 2"}
      ],
      "getReviews": {
        "payload": [
          {
            "author": {...},
            "text": "...",
            "likes": {...}
          }
        ]
      }
    }
  }
}
</script>
```

#### 3. Meta-—Ç–µ–≥–∏
```html
<meta property="og:title" content="–§—Ä–∞–Ω—Ü—É–∑—Å–∫–∞—è –∫–æ—Å–∏—á–∫–∞">
<meta property="og:image" content="https://...cover.jpg">
<meta property="og:description" content="–ê–Ω–Ω–æ—Ç–∞—Ü–∏—è...">
```

#### 4. HTML-—Å–µ–ª–µ–∫—Ç–æ—Ä—ã
```html
<div data-testid="book-factoids__livelib">
  <span class="fe68c5c8">3,7</span>
  <span class="_63638bfa">951 –æ—Ü–µ–Ω–∫–∞</span>
</div>
```

### –ê–ª–≥–æ—Ä–∏—Ç–º –ø–∞—Ä—Å–∏–Ω–≥–∞:

```python
def parse_book_page(html, url):
    soup = BeautifulSoup(html, 'lxml')
    out = {"url": url}
    
    # 1. –ò—â–µ–º JSON-LD
    jsonld = _extract_jsonld(soup)
    if jsonld:
        out["title"] = jsonld.get("name")
        out["authors"] = jsonld.get("author")
        # –∏ —Ç.–¥.
    
    # 2. –ò—â–µ–º __NEXT_DATA__
    next_data = _extract_next_data(soup)
    if next_data:
        livelib = next_data.get("livelib", {})
        out["livelib_rating"] = livelib.get("rating")
        # –∏ —Ç.–¥.
    
    # 3. Fallback –Ω–∞ meta-—Ç–µ–≥–∏
    if not out.get("title"):
        out["title"] = soup.find("meta", property="og:title")
    
    # 4. Fallback –Ω–∞ HTML
    if not out.get("title"):
        out["title"] = soup.select_one("h1.title")
    
    return out
```

### –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞:

**LiveLib –¥–∞–Ω–Ω—ã–µ:**
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `__NEXT_DATA__` ‚Üí `data-testid` ‚Üí hash-–∫–ª–∞—Å—Å—ã ‚Üí —Ä–µ–≥—É–ª—è—Ä–∫–∏
- –ü—Ä–æ–±–ª–µ–º–∞: hash-–∫–ª–∞—Å—Å—ã –º–µ–Ω—è—é—Ç—Å—è –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ —Å–∞–π—Ç–∞
- –†–µ—à–µ–Ω–∏–µ: –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π fallback

**–ì–ª–∞–≤—ã –∫–Ω–∏–≥–∏:**
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `__NEXT_DATA__.getArtTOC` ‚Üí HTML —Å–µ–ª–µ–∫—Ç–æ—Ä—ã
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∞—è –∑–∞–≥—Ä—É–∑–∫–∞: —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ JSON

**–û—Ç–∑—ã–≤—ã:**
- –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç: `__NEXT_DATA__.getReviews` ‚Üí HTML –ø–∞—Ä—Å–∏–Ω–≥
- –†–µ–ø–ª–∞–∏: –≤–ª–æ–∂–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ JSON
- –°–≤—è–∑—å: —á–µ—Ä–µ–∑ `review_id` –∏ `replies` –º–∞—Å—Å–∏–≤

**–ê—É–¥–∏–æ–∫–Ω–∏–≥–∏:**
- –û—Ç–¥–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞-–ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –Ω–∞ —Å–∞–π—Ç–µ
- –î–∞–Ω–Ω—ã–µ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏
- –ü–∞—Ä—Å—è—Ç—Å—è –∏–∑ —Ç–æ–≥–æ –∂–µ `__NEXT_DATA__`

---

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### 1. –°–ø–∞—Ä—Å–∏—Ç—å –æ–¥–Ω—É –∫–Ω–∏–≥—É:
```bash
python main.py single https://www.litres.ru/book/enn-tayler/francuzskaya-kosichka-69950011/
```

### 2. –ù–∞–π—Ç–∏ 1000 –∫–Ω–∏–≥:
```bash
python main.py discover --limit 1000
```

### 3. –°–ø–∞—Ä—Å–∏—Ç—å –æ—á–µ—Ä–µ–¥—å (5 –ø–æ—Ç–æ–∫–æ–≤):
```bash
python main.py crawl --workers 5
```

### 4. –°–ø–∞—Ä—Å–∏—Ç—å —Å –æ—Ç–∑—ã–≤–∞–º–∏:
```bash
python main.py crawl --workers 5 --with-reviews
```

### 5. –°–ø–∞—Ä—Å–∏—Ç—å –Ω–æ–≤—ã–µ –∫–Ω–∏–≥–∏ + —ç–∫—Å–ø–æ—Ä—Ç:
```bash
python main.py crawl --discover --discover-limit 500 --workers 5 --limit 100
python main.py export --out books.xlsx
```

### 6. –î–æ–±–∞–≤–∏—Ç—å URL –≤—Ä—É—á–Ω—É—é:
```bash
python main.py add https://www.litres.ru/book/...
```

### 7. –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É:
```bash
python main.py status
```

### 8. –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å:
```bash
python main.py reset
```

---

## –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö üÜï

**–í–ê–ñ–ù–û:** –î–∞–Ω–Ω—ã–µ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è **–ü–†–ò –ü–ê–†–°–ò–ù–ì–ï**, –∞ –Ω–µ –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ!

### –ù–æ–≤–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:
```
–ü–∞—Ä—Å–∏–Ω–≥ ‚Üí –°—ã—Ä–æ–π JSON ‚Üí –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ‚Üí –ù–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π JSON ‚Üí –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö ‚Üí Excel
```

### –ü—Ä–∏–º–µ—Ä—ã –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏:

### –î–∞—Ç—ã:
- **–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ:** `2023-11-20T13:48:18`
- **–í –ë–î –∏ Excel:** `20.11.2023` ‚úÖ

### –¶–µ–Ω–∞:
- **–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ:** `569 RUB`
- **–í –ë–î –∏ Excel:** `569,00` ‚úÖ

### –í–æ–∑—Ä–∞—Å—Ç:
- **–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ:** `18+`
- **–í –ë–î –∏ Excel:** `18` ‚úÖ

### –°–µ—Ä–∏–∏:
- **–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ:** `–í—Ö–æ–¥–∏—Ç –≤ —Å–µ—Ä–∏—é ¬´–ò—Ä–æ–Ω–∏—á–µ—Å–∫–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤ (–≠–∫—Å–º–æ)¬ª\n\n1 –∫–Ω–∏–≥–∞ –∏–∑ 2 –≤ —Å–µ—Ä–∏–∏ ¬´–ö–æ—à–º–∞—Ä—ã –ß–µ—Ä–Ω–æ–ª—É—á—å—è¬ª`
- **–í –ë–î –∏ Excel:** `–ò—Ä–æ–Ω–∏—á–µ—Å–∫–∏–π –¥–µ—Ç–µ–∫—Ç–∏–≤ (–≠–∫—Å–º–æ)\n\n–ö–æ—à–º–∞—Ä—ã –ß–µ—Ä–Ω–æ–ª—É—á—å—è` ‚úÖ

### –ê–≤–∞—Ç–∞—Ä–∫–∏:
- **–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ:** `/pub/avatar/100/00/04/52/31/40/40/452314040.jpg`
- **–í –ë–î –∏ Excel:** `–µ—Å—Ç—å` ‚úÖ

### –°—á–µ—Ç—á–∏–∫–∏:
- **–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ:** `547 –æ—Ü–µ–Ω–æ–∫`
- **–í –ë–î –∏ Excel:** `547` ‚úÖ

### –†–µ–π—Ç–∏–Ω–≥–∏:
- **–°—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ:** `4,9`
- **–í –ë–î –∏ Excel:** `4.9` ‚úÖ

---

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:
```
requests        # HTTP –∑–∞–ø—Ä–æ—Å—ã
beautifulsoup4  # HTML –ø–∞—Ä—Å–∏–Ω–≥
lxml            # XML –ø–∞—Ä—Å–µ—Ä (–±—ã—Å—Ç—Ä–µ–µ html.parser)
openpyxl        # Excel —ç–∫—Å–ø–æ—Ä—Ç
```

### Rate-limiting:
- –ì–ª–æ–±–∞–ª—å–Ω–∞—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞ —á–µ—Ä–µ–∑ `threading.Lock()`
- –ó–∞–¥–µ—Ä–∂–∫–∞: 0.5-1.5 —Å–µ–∫—É–Ω–¥—ã (—Å–ª—É—á–∞–π–Ω–∞—è)
- –¶–µ–ª—å: –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—Ç—å —Å–µ—Ä–≤–µ—Ä LitRes

### –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å:
- –†–µ—Ç—Ä–∞–∏ –ø—Ä–∏ HTTP –æ—à–∏–±–∫–∞—Ö (4 –ø–æ–ø—ã—Ç–∫–∏)
- –û—à–∏–±–∫–∏ –Ω–µ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç –≤–µ—Å—å –ø—Ä–æ—Ü–µ—Å—Å
- –ü—Ä–æ–≥—Ä–µ—Å—Å —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ SQLite
- –ú–æ–∂–Ω–æ –ø—Ä–µ—Ä–≤–∞—Ç—å –∏ –ø—Ä–æ–¥–æ–ª–∂–∏—Ç—å –ø–æ–∑–∂–µ

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å:
- 5 –ø–æ—Ç–æ–∫–æ–≤ ‚Üí ~200-300 –∫–Ω–∏–≥/—á–∞—Å (—Å –∑–∞–¥–µ—Ä–∂–∫–∞–º–∏)
- SQLite WAL —Ä–µ–∂–∏–º –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –∑–∞–ø–∏—Å–∏
- –ë–∞—Ç—á–µ–≤–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–∑—ã–≤–æ–≤

---

## –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. **–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–π –∫–æ–Ω—Ç–µ–Ω—Ç:**
   - –ù–µ–∫–æ—Ç–æ—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –ø–æ–¥–≥—Ä—É–∂–∞—é—Ç—Å—è JavaScript
   - –†–µ—à–µ–Ω–∏–µ: –ø–∞—Ä—Å–∏–Ω–≥ `__NEXT_DATA__`

2. **Hash-–∫–ª–∞—Å—Å—ã:**
   - CSS –∫–ª–∞—Å—Å—ã –≤–∏–¥–∞ `fe68c5c8` –º–µ–Ω—è—é—Ç—Å—è
   - –†–µ—à–µ–Ω–∏–µ: `data-testid` + –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π fallback

3. **–ë–ª–æ–∫–∏—Ä–æ–≤–∫–∏:**
   - –°–∞–π—Ç –º–æ–∂–µ—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å IP –ø—Ä–∏ –∞–≥—Ä–µ—Å—Å–∏–≤–Ω–æ–º –ø–∞—Ä—Å–∏–Ω–≥–µ
   - –†–µ—à–µ–Ω–∏–µ: rate-limiting, –∑–∞–¥–µ—Ä–∂–∫–∏

4. **–ù–µ–ø–æ–ª–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ:**
   - –ù–µ –≤—Å–µ –∫–Ω–∏–≥–∏ –∏–º–µ—é—Ç –≤—Å–µ –ø–æ–ª—è
   - –†–µ—à–µ–Ω–∏–µ: graceful degradation (–ø—É—Å—Ç—ã–µ —Å—Ç—Ä–æ–∫–∏)

---

## –ó–∞–∫–ª—é—á–µ–Ω–∏–µ

**LitRes Parser** ‚Äî —ç—Ç–æ –Ω–∞–¥–µ–∂–Ω—ã–π –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—ã–π –ø–∞—Ä—Å–µ—Ä –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –∫–Ω–∏–≥ —Å:
- ‚úÖ –ú–Ω–æ–≥–æ–ø–æ—Ç–æ—á–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–æ–π
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ–º –ø—Ä–æ–≥—Ä–µ—Å—Å–∞
- ‚úÖ –í–µ–∂–ª–∏–≤—ã–º rate-limiting
- ‚úÖ –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–º fallback –¥–ª—è –Ω–∞–¥–µ–∂–Ω–æ—Å—Ç–∏
- ‚úÖ –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–µ–π –¥–∞–Ω–Ω—ã—Ö –ø—Ä–∏ —ç–∫—Å–ø–æ—Ä—Ç–µ
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∫–æ–π –æ—Ç–∑—ã–≤–æ–≤ –∏ —Ä–µ–ø–ª–∞–µ–≤

**–ò–¥–µ–∞–ª—å–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç –¥–ª—è:**
- –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è –∫–∞—Ç–∞–ª–æ–≥–∞ LitRes
- –ê–Ω–∞–ª–∏–∑–∞ —Ä–µ–π—Ç–∏–Ω–≥–æ–≤ –∏ –æ—Ç–∑—ã–≤–æ–≤
- –°–±–æ—Ä–∞ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ç–µ–ª—å–Ω—ã—Ö —Å–∏—Å—Ç–µ–º
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞ —Ü–µ–Ω
